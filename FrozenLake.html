<p id="Q"></p>
<canvas id="canvas"></canvas>
<button onclick="frame()">Frame!</button>
<script>
var canvas = document.getElementById("canvas");
var ctx = canvas.getContext('2d');
ctx.canvas.height = 400

//The importance of memory
var gamma = 0.8;
//What the map looks like as a 2d array
var R = [
	[-001, -001, -001, -001],
	[-001, -100, -001, -100],
	[-001, -001, -001, -100],
	[-100, -001, -001, 100]
];

//Index 5, 7, 11, 12, and 15 are all endings, with 15 being the goal.
//The actual goal stuff, as seen by the algorithm.
//-999 means it's impossible to move in that direction, and -100 is a hole, while 100 is the goal. 
var R = [
	[-999, -1, -999, -1],
    [-999, -100, -1, -1],
    [-999, -1, -1, -1],
    [-999, -100, -1, -999],
    
    [-1, -1, -999, -100],
    [-1, -1, -1, -1],
    [-1, -1, -100, -100],
    [-1, -100, -1, -999],
    
    [-1, -100, -999, -1],
    [-100, -1, -1, -1],
    [-1, -1, -1, -100],
    [-100, 100, -1, -999],
    
    [-1, -999, -999, -1],
    [-1, -999, -100, -1],
    [-1, -999, -1, 100],
    [-100, -999, -1, -999]
];

var Q = [
	[0, 0, 0, 0],
	[0, 0, 0, 0],
	[0, 0, 0, 0],
	[0, 0, 0, 0],
	[0, 0, 0, 0],
	[0, 0, 0, 0],
	[0, 0, 0, 0],
	[0, 0, 0, 0],
	[0, 0, 0, 0],
	[0, 0, 0, 0],
	[0, 0, 0, 0],
	[0, 0, 0, 0],
	[0, 0, 0, 0],
	[0, 0, 0, 0],
	[0, 0, 0, 0],
	[0, 0, 0, 0]

];



function getRandomInt(min, max) {
	// Create byte array and fill with 1 random number
	var byteArray = new Uint8Array(1);
	window.crypto.getRandomValues(byteArray);

	var range = max - min + 1;
	var max_range = 256;
	if (byteArray[0] >= Math.floor(max_range / range) * range)
		return getRandomInt(min, max);
	return min + (byteArray[0] % range);
}


var state = getRandomInt(0, 15)
var action = getRandomInt(0, 3);

function frame() {
	//If the state is on an ending state, then roll for a new state
	while(state == 15 || state == 12 || state == 11 || state == 5 || state == 7){
    	state = getRandomInt(0, 15);
    }
    
    //If the action is impossible, roll for a new one
    while(R[state][action] == -999){
		action = getRandomInt(0, 3);
    }
    
    var possibleActions = [];
    //The Q of every action
	var possibleActionsQ = [];
    
    
    
    for(var i = 0; i < 4; i++){
      if(action == 0){
        if (R[state - 4][i] !== -999){
            possibleActions.push(i);
            possibleActionsQ.push(Q[action][i]);
        }
      
      } else if(action == 1){
        if (R[state + 4][i] !== -999){
            possibleActions.push(i);
            possibleActionsQ.push(Q[action][i]);
        }
} else if(action == 2){
        if (R[state - 1][i] !== -999){
            possibleActions.push(i);
            possibleActionsQ.push(Q[action][i]);
        }
} else if(action == 3){

        if (R[state + 1][i] !== -999){
            possibleActions.push(i);
            possibleActionsQ.push(Q[action][i]);
        }
}


      if(i == 3){
      document.getElementById("Q").innerHTML += "<p> State:" + state + "</p>" + "<p> Action:" + action + "<p>"+R[state][action]+"</p>"
      }
    }
    
    for(var i = 0; i < Q.length; i++){
          if(i == 0){
        document.getElementById("Q").innerHTML = "";
      }
      document.getElementById("Q").innerHTML += "<p> " + i + " [" + Q[i] + "]</p>" ;
      
    }

    
	Q[state][action] = R[state][action] + gamma * Math.max.apply(null, possibleActionsQ);
    
    
    
   	if(action == 0){
    	state -= 4;
    } else if(action == 1){
    	state += 4;
    } else if(action == 2){
    	state --;
    } else if(action == 3){
    	state ++;
    }
    
    ctx.fillStyle = 'black';

    

requestAnimationFrame(frame);
    
}

frame();
</script>
